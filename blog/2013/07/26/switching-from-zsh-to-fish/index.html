
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Switching From Zsh to Fish - Michel P. Macedo</title>
  <meta name="author" content="Michel Pavan Macedo">

  
  <meta name="description" content="Not long ago I heard of fish (friendly interactive shell) and I decided it was worth a test drive. I have a decent configuration for zsh, with most &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://michelpm.com/blog/2013/07/26/switching-from-zsh-to-fish">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/michelpm" rel="alternate" title="Michel P. Macedo" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<script src="/blog/javascripts/switchlang.js"></script>

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-26194428-1', 'auto');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">Michel P. Macedo</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="http://feeds.feedburner.com/michelpm" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="http://feedburner.google.com/fb/a/mailverify?uri=michelpm&amp;loc=en_US" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:michelpm.com/blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Switching From Zsh to Fish</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-07-26T00:00:00-03:00'><span class='date'>2013-07-26</span> <span class='time'></span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://michelpm.com/blog/blog/2013/07/26/switching-from-zsh-to-fish/">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Not long ago I heard of <a href="http://fishshell.com">fish (friendly interactive shell)</a> and I decided it was worth a test drive. I have a decent configuration for zsh, with most credits to <a href="https://github.com/robbyrussell/oh-my-zsh">Oh My Zsh!</a>, but I was determined to get rid of most my dotfiles, as it is one of my greatest excuses to procrastinate, however tidy. Fish comes with lots of things out of the box, so I decided to replace zsh even if it meant to lose a thing or two.</p>

<h2>Trying out fish</h2>

<p>Being on Ubuntu, I found a ppa with very up to date fish:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo add-apt-repository -y ppa:fish-shell/nightly-master
</span><span class='line'>sudo apt-get update
</span><span class='line'>sudo apt-get install -y fish
</span><span class='line'>chsh -s /usr/bin/fish</span></code></pre></td></tr></table></div></figure>


<p>I opened fish and started to type things to test. Syntax highlighting and history completion were great and beautiful. Completion is a little bit different, not as good as zsh&rsquo;s with lots of plugins and configurations, but close enough and again prettier. The syntax is very nice but it is not at all compatible with popular shells and not even POSIX. The name is hard to search and the documentation and community not big enough, but I managed to translate all my functions using the <a href="http://fishshell.com/tutorial.html">tutorial</a> and the <a href="http://fishshell.com/docs/current/index.html">documentation</a>. Even harder than learning fish was to understand every feature of bash to translate the code to fish.</p>

<h2>Oh My Fish!</h2>

<p>The fish configuration on the browser (fish_config command) is a neat concept, with a cool prompt visualizer (beats my <a href="https://gist.github.com/mmacedo/4047615">xterm opener</a>), but disappointing as I didn&rsquo;t find anything worth configuring there. Already feeling like something was missing, I searched for <a href="https://github.com/bpinto/oh-my-fish">Oh My Fish!</a>, and I found exactly what I needed to have a complete shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>curl -L https://github.com/bpinto/oh-my-fish/raw/master/tools/install.sh | bash</span></code></pre></td></tr></table></div></figure>


<p>Instead of a <code>~/.fishrc</code>, the fish configuration goes into <code>~/.config/fish/config.fish</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set fish_path $HOME/.oh-my-fish
</span><span class='line'>. $fish_path/oh-my-fish.fish</span></code></pre></td></tr></table></div></figure>


<h2>Prompt / Theme</h2>

<p>I still had to pick a good prompt to replace Oh My Zsh!&rsquo;s <a href="http://www.maxmasnick.com/2012/09/02/zsh/">fino theme</a>. <a href="https://github.com/bpinto/oh-my-fish/pull/27">Numist</a> is pretty much the same theme, but it doesn&rsquo;t show the ruby version. I added my custom version of oh-my-fish&rsquo;s numist theme with the ruby version from oh-my-zsh&rsquo;s fino theme:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set -l ruby_info
</span><span class='line'>if which rvm-prompt &gt;/dev/null ^&1
</span><span class='line'>  set ruby_info (rvm-prompt i v g)
</span><span class='line'>else
</span><span class='line'>  if which rbenv &gt;/dev/null ^&1
</span><span class='line'>    set ruby_info (rbenv version-name)
</span><span class='line'>  end
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>test $ruby_info; and set ruby_info "$normal""using $magenta‹$ruby_info›"</span></code></pre></td></tr></table></div></figure>


<h2>Tools</h2>

<p>Somehow the few plugins of Oh My Fish! were enough to cater for my needs. I don&rsquo;t know why, but <a href="https://github.com/sstephenson/rbenv">rbenv</a> works fine, the <a href="https://github.com/bpinto/oh-my-fish/tree/master/plugins/rake">rake</a> and <a href="https://github.com/bpinto/oh-my-fish/tree/master/plugins/bundler">bundler</a> plugins are as good as their Oh My Zsh! counterparts. The <a href="https://github.com/bpinto/oh-my-fish/tree/master/plugins/node">node</a> plugin works, but the completions that were supposed to be automatically generated from node&rsquo;s and npm&rsquo;s manpages, weren&rsquo;t. One plugin that I miss is completions for the <a href="https://github.com/heroku/heroku">heroku CLI</a>, since it doesn&rsquo;t have a manpage (shame on heroku for that).</p>

<p>Most tools, however, are not compatible with fish: how would them? It coincided that I wanted to try a new tool (<a href="https://github.com/creationix/nvm">nvm</a>) for which there was no fish shim or fish plugin. Inspired by a <a href="https://github.com/fish-shell/fish-shell/issues/522#issuecomment-12485379">script</a> that attempted to source POSIX/bash syntax files, I decided to write my own <code>source</code> function that could execute bash code and reproduce or simulate the changes to variables and functions on fish:</p>

<div><script src='https://gist.github.com/6083809.js?file=source.fish'></script>
<noscript><pre><code>function _exec_with
  set -l shell $argv[1]
  set -l file $argv[2]
  set -l code $argv[3]

  set -l source
  switch &quot;$shell&quot;
    case bash zsh ksh
      set source .
    case &#39;*&#39;
      echo &quot;Unknown shell &#39;$shell&#39;&quot; &gt;&amp;2
      return 1
  end

  # List variables, ignore $_, $PIPESTATUS, $COLUMNS and $SHLVL
  set -l variable_names &quot;env | grep -v &#39;^_|PIPESTATUS|COLUMNS|SHLVL\\\$&#39; | sort&quot;
  # List functions, find headers (lines with &#39;()&#39;), keep only the name of the
  #  function (remove after the first space or &#39;(&#39;), ignore names with &#39;$&#39;
  set -l function_names &quot;typeset -f | grep &#39;^[^ (]\\+ \\?()&#39; | sed &#39;s/^\\([^ (]\\+\\).*/\\1/&#39; | grep -v &#39;\\\$&#39; | sort&quot;
  # List aliases, remove &#39;alias &#39; preffix if present and the value (everything after the =)
  set -l aliases_names &quot;alias | sed &#39;s/\\(alias \\)\\?\\([^=]\\+\\).*/\\2/&#39; | sort&quot;

  # Create temp files to catch the change of variables and functions
  set -l variables_before (mktemp)
  set -l variables_after (mktemp)
  set -l functions_before (mktemp)
  set -l functions_after (mktemp)
  set -l aliases_before (mktemp)
  set -l aliases_after (mktemp)

  set -l before &quot;$variable_names &gt; $variables_before; $function_names &gt; $functions_before; $aliases_names &gt; $aliases_before&quot;
  set -l after &quot;$variable_names &gt; $variables_after; $function_names &gt; $functions_after; $aliases_names &gt; $aliases_after&quot;

  /usr/bin/env $shell -c &quot;$before; $source $file; $code $after&quot;

  # Separator used by read to store a single line into several variables
  set -l IFS =

  # Diff of the env in the format (+|-)=(?&lt;VAR&gt;.+)=(?&lt;VALUE&gt;.+)
  set -l diffopts --old-line-format &#39;-=%L&#39; --new-line-format &#39;+=%L&#39; --unchanged-line-format &#39;&#39;

  diff $diffopts $variables_before $variables_after | while read -l state var value
    switch $state$var
      case -PATH -MANPATH
        continue
      case +PATH +MANPATH
        # split by colons into an array
        eval set value (echo $value | sed &#39;s/:$//&#39; | sed &#39;s/:\?\([^:]\+\)/&quot;\1&quot; /g&#39;)
        # reverse array (because preprending will cause reversing again)
        set -l temp; for i in $value; set temp $i $temp; end; set value $temp

        # Sync dirs removed from the path
        for dir in $$var
          if contains $dir $value; continue; end

          # DEBUG:
          # echo remove \&quot;$dir\&quot; from the \${$var}

          eval set -e $var\[(contains -i $dir $$var)\]
        end

        # Sync dirs added to the path
        for dir in $value
          if contains $dir $$var; continue; end

          # DEBUG:
          # echo prepend \&quot;$dir\&quot; to the \${$var}

          set -gx $var &quot;$dir&quot; $$var
        end
      case &#39;-*&#39;
        # DEBUG:
        # echo unset $var \(old: \&#39;{$$var}\&#39;\)

        set -e $var
      case &#39;+*&#39;
        # DEBUG:
        # echo Set \${$var} to \&#39;$value\&#39; \(old: \&#39;{$$var}\&#39;\)

        set -gx $var $value
      case &#39;*&#39;
        echo &quot;Source error! Invalid case &#39;$state$var&#39;&quot; &gt;&amp;2
    end
  end

  diff $diffopts $functions_before $functions_after | while read -l state func
    switch $state$func
      case &#39;-*&#39;
        # Do nothing if a function was removed
        continue
      case &#39;+*&#39;
        # Create wrapper function
        eval &quot;function $func; _exec_with $shell \&quot;$file\&quot; \&quot;$func \$argv;\&quot;; end&quot;

        # DEBUG:
        # echo Create wrapper for function $func from $file
      case &#39;*&#39;
        echo &quot;Source error! Invalid case &#39;$func&#39;&quot; &gt;&amp;2
    end
  end

  diff $diffopts $aliases_before $aliases_after | while read -l state func
    switch $state$func
      case &#39;-*&#39;
        # Do nothing if an alias was removed
        continue
      case &#39;+*&#39;
        # code to manually execute an alias
        set -l exec_alias &quot;eval \\\$(eval echo `alias $func | sed &#39;s/\\(alias \\)\\?[^=]\\+=//&#39;`) \\\$argv&quot;

        # Create wrapper function
        eval &quot;function $func; _exec_with $shell \&quot;$file\&quot; \&quot;$exec_alias;\&quot;; end&quot;

        # DEBUG:
        # echo Create wrapper for alias $func from $file
      case &#39;*&#39;
        echo &quot;Source error! Invalid case &#39;$func&#39;&quot; &gt;&amp;2
    end
  end

  # Remove temporary files
  command rm $variables_before $variables_after $functions_before $functions_after $aliases_before $aliases_after &gt;/dev/null
end

function source --description &#39;Source bash/zsh/ksh files&#39;
  set -l type
  while true
    if test (count $argv) -eq 0
      echo &quot;Called with no arguments&quot; &gt;&amp;2
      return 1
    end
    switch $argv[1]
      case &#39;--*&#39;
        set type (echo $argv[1] | sed &#39;s/^--//&#39;)
      case &#39;*&#39;
        break
    end
    set -e argv[1]
  end

  for file in $argv
    set -l file_type $type
    if not test &quot;$file_type&quot;
      switch (readlink -f $file)
        case &#39;*.sh&#39;, &#39;**/.bash*&#39;
          set file_type bash
        case &#39;*.zsh&#39;, &#39;**/.zsh*&#39;
          set file_type zsh
        case &#39;*.ksh&#39;, &#39;**/.ksh*&#39;
          set file_type ksh
        case &#39;**/.profile&#39;, &#39;*&#39;
          set file_type bash
      end
    end

    _exec_with $file_type &quot;$file&quot; &quot;&quot;
  end
end
</code></pre></noscript></div>


<h2>Conclusion</h2>

<p>My fish configuration now looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Oh My Fish!
</span><span class='line'>set fish_path $HOME/.oh-my-fish
</span><span class='line'>set fish_theme my
</span><span class='line'>set fish_plugins rbenv rake bundler node
</span><span class='line'>. $fish_path/oh-my-fish.fish
</span><span class='line'>
</span><span class='line'># nvm
</span><span class='line'>. $HOME/.config/fish/source.fish
</span><span class='line'>source --bash $HOME/.nvm/nvm.sh
</span><span class='line'>
</span><span class='line'>. $HOME/.config/fish/functions.fish</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Michel Pavan Macedo</span></span>

      




<time class='entry-date' datetime='2013-07-26T00:00:00-03:00'><span class='date'>2013-07-26</span> <span class='time'></span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/bash/'>bash</a>, <a class='category' href='/blog/categories/fish/'>fish</a>, <a class='category' href='/blog/categories/shell/'>shell</a>, <a class='category' href='/blog/categories/zsh/'>zsh</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/05/15/i18n-of-css-generated-content/" title="Previous Post: I18n of CSS generated content">&laquo; I18n of CSS generated content</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/12/18/lines-of-code-and-kilos-of-cake/" title="Next Post: Lines Of Code And Kilos Of Cake">Lines Of Code And Kilos Of Cake &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>I code awesome software for fun and work. These are the articles that I haven&#8217;t overthought to abandonment.</p>
  <p>Enough <a href="http://about.me/michelpm">about me</a>.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/12/18/lines-of-code-and-kilos-of-cake/">Lines of Code and Kilos of Cake</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/26/switching-from-zsh-to-fish/">Switching From Zsh to Fish</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/15/i18n-of-css-generated-content/">I18n of CSS Generated Content</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/23/twitter-bootstrap-and-jruby-on-rails/">Twitter Bootstrap and JRuby on Rails</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/11/functional-javascript/">Functional JavaScript</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Books I&#8217;m Reading</h1>
  <div id="ShelfariWidget242960">
    <a href='http://www.shelfari.com/'>Shelfari: Book reviews on your book blog</a>
    <script src="http://www.shelfari.com/ws/242960/widget.js?r=29470" type="text/javascript" language="javascript"></script>
  </div>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Michel Pavan Macedo -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'halfsw';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://michelpm.com/blog/blog/2013/07/26/switching-from-zsh-to-fish/';
        var disqus_url = 'http://michelpm.com/blog/blog/2013/07/26/switching-from-zsh-to-fish/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
