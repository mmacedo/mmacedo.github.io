<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Step by step animated guide to build CSS clocks.">
  <meta name="author" content="Michel Pavan Macedo">

  <title>Clocks</title>

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">

  <!-- Bootstrap -->
  <link href="/clock/css/bootstrap.min.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="/clock/css/railscasts.css">

  <style type="text/css">
    .example-box {
      display: inline-block;
      width: 20em;
      height: 20em;
      overflow: hidden;
    }

    .example-box, .example-box-small, .example-code {
      margin: 2em 0;
    }

    .crosshairs {
      position: relative;
    }

    .crosshairs > .crosshairs-layer {
      position: absolute;
      width: 100%; height: 100%;
      z-index: -9999;
    }

    .crosshairs-layer > .crosshairs-vertical,
    .crosshairs-layer > .crosshairs-horizontal {
      position: absolute;
      opacity: .2;
    }

    .crosshairs-layer > .crosshairs-vertical {
      top: 0; height: 100%;
      left: 50%; width: 2px; margin-left: -1px;
    }

    .crosshairs-layer > .crosshairs-horizontal {
      left: 0; width: 100%;
      top: 50%; height: 2px; margin-top: -1px;
    }

    .page-header .anchor {
      color: #bcbcbc;
      font-size: 65%;
      margin-left: -30px;
      visibility: hidden;
    }

    .page-header:hover .anchor {
      visibility: visible;
    }
  </style>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-26194428-1', 'michelpm.com');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>
</head>
<body>
  <div class="container">
    <h1>Clock</h1>
    <p>Attempt to reverse engineer and rewrite step by step this <a href="http://codepen.io/iliadraznin/pen/JcqbE">pure-CSS3 clock</a> in order to build me a <a href="https://en.wikipedia.org/wiki/Decimal_time">decimal time</a> clock.</p>
    <p>I want it parameterized to be easier to understand and write the final code, so I use <a href="https://lodash.com/docs#template">_.template</a> for the HTML and <a href="http://lesscss.org/">Less</a> for the CSS.</p>
    <h2 id="frame" class="page-header">
      <a href="#frame" aria-hidden="true" class="anchor"><span class="glyphicon glyphicon-link"></span></a>
      Frame
    </h2>
    <script id="frame_transition_css" type="text/example-css">
      @clockSize: 20em;
      @borderSize: .5em;

      @keyframes addFrame {
        0% {
          width: @borderSize * 2;
          height: @borderSize * 2;
          margin-left: (@clockSize / 2);
          margin-top: (@clockSize / 2);
        }
        25% {
          width: @clockSize;
          height: @clockSize;
          margin-left: 0;
          margin-top: 0;
        }
        50% {
          width: @clockSize;
          height: @clockSize;
          margin-left: 0;
          margin-top: 0;
          border-radius: 0;
        }
        75% {
          width: @clockSize;
          height: @clockSize;
          margin-left: 0;
          margin-top: 0;
          border-radius: (@clockSize / 2);
        }
        100% {
          width: @clockSize;
          height: @clockSize;
          margin-left: 0;
          margin-top: 0;
          border-radius: (@clockSize / 2);
        }
      }

      #watch .frame {
        animation: addFrame 4s normal infinite;
        background: white;
        border: @borderSize solid black;
      }
    </script>
    <div class="text-center">
      <div id="frame_transition_box" class="example-box" data-example="box" data-html="frame_1_html" data-css="frame_transition_css"></div>
    </div>
    <p><strong>Add the fame.</strong> Create a <code>&lt;div&gt;</code> with the same <code>height</code> and <code>width</code>. I made it proportional to the digit size by using a size in <code>em</code>. I added a background and border to make the frame visible in the white background.</p>
    <script id="frame_1_html" type="text/example-html">
      <div id="watch">
        <div class="frame"></div>
      </div>
    </script>
    <script id="frame_1_css" type="text/example-css">
      @clockSize: 20em;

      #watch .frame {
        width: @clockSize; height: @clockSize;
        background: white;
        border: .5em solid black;
      }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="frame_1_box" class="example-box" data-example="box" data-html="frame_1_html" data-css="frame_1_css"></div>
      </div>
      <div class="col-md-6">
        <div id="frame_1_html_code" class="example-code" data-example="html" data-html="frame_1_html"></div>
        <div id="frame_1_css_code" class="example-code" data-example="css" data-css="frame_1_css"></div>
      </div>
    </div>
    <p><strong>Make it round.</strong> Make the <code>border-radius</code> half the size of the clock.</p>
    <script id="frame_2_css" type="text/example-css" data-import="frame_1_css">
      #watch .frame {
        width: @clockSize; height: @clockSize;
        border-radius: (@clockSize / 2);
      }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="frame_2_box" class="example-box" data-example="box" data-html="frame_1_html" data-css="frame_2_css"></div>
      </div>
      <div class="col-md-6">
        <div id="frame_2_css_code" class="example-code" data-example="css" data-css="frame_2_css"></div>
      </div>
    </div>
    <h2 id="digits" class="page-header">
      <a href="#digits" aria-hidden="true" class="anchor"><span class="glyphicon glyphicon-link"></span></a>
      Digits
    </h2>
    <script id="digits_transition_css" type="text/example-css">
      @clockSize: 20em;
      @digitSize: 1em;
      @digitMargin: 1em;
      @hours: 12;

      #watch .digits {
        list-style: none; margin: 0; padding: 0;
        width: @clockSize; height: @clockSize;
        border-radius: (@clockSize / 2);
        position: relative;
      }

      #watch .digits li {
        font-weight: bold;
        font-family: sans-serif;
        display: block;
        width: @digitSize; height: @digitSize;
        line-height: @digitSize;
        text-align: center;
        position: absolute;
        .animationsForEachDigit;
      }

      .animationsForEachDigit(@hour:1) when (@hour <= @hours) {
        @rotate: (360deg / @hours) * @hour;
        @translate: (@clockSize / 2) -
                    (@digitSize / 2) -
                    @digitMargin;

        @keyframes ~"addDigit@{hour}" {
          0% {
            top: (@digitSize * 1.42857143 * (@hour - 1));
            left: 0;
            margin: 0;
          }
          12.5% {
            top: 50%; left: 50%;
            margin: -(@digitSize / 2) 0 0 -(@digitSize / 2);
          }
          25% {
            top: 50%; left: 50%;
            margin: -(@digitSize / 2) 0 0 -(@digitSize / 2);
            transform: rotate(0);
          }
          37.5% {
            top: 50%; left: 50%;
            margin: -(@digitSize / 2) 0 0 -(@digitSize / 2);
            transform: rotate(@rotate);
          }
          50% {
            top: 50%; left: 50%;
            margin: -(@digitSize / 2) 0 0 -(@digitSize / 2);
            transform: rotate(@rotate) translateY(0);
          }
          62.5% {
            top: 50%; left: 50%;
            margin: -(@digitSize / 2) 0 0 -(@digitSize / 2);
            transform: rotate(@rotate)
                       translateY(-@translate);
          }
          75% {
            top: 50%; left: 50%;
            margin: -(@digitSize / 2) 0 0 -(@digitSize / 2);
            transform: rotate(@rotate)
                       translateY(-@translate)
                       rotate(0);
          }
          87.5% {
            top: 50%; left: 50%;
            margin: -(@digitSize / 2) 0 0 -(@digitSize / 2);
            transform: rotate(@rotate)
                       translateY(-@translate)
                       rotate(-@rotate);
          }
          100% {
            top: 50%; left: 50%;
            margin: -(@digitSize / 2) 0 0 -(@digitSize / 2);
            transform: rotate(@rotate)
                       translateY(-@translate)
                       rotate(-@rotate);
          }
        }

        &:nth-child(@{hour}) {
          animation: ~"addDigit@{hour}" 8s ease infinite;
        }

        .animationsForEachDigit((@hour + 1));
      }
    </script>
    <div class="text-center">
      <div id="digits_transition_box" class="example-box" data-example="box" data-html="digits_html" data-css="digits_transition_css"></div>
    </div>
    <p><strong>Add a digit.</strong> Since we are using a <code>&lt;ul&gt;</code>, we have to clear the style by removing <code>list-style</code>, <code>margin</code> and <code>padding</code>. <span class="bg-warning">Extra borders added for testing purposes.</span></p>
    <script id="single_digit_1_html" type="text/example-html">
      <div id="watch">
        <ul class="digits">
          <li>1</li>
        </ul>
      </div>
    </script>
    <script id="single_digit_1_css" type="text/example-css">
      #watch .digits { list-style: none; margin: 0; padding: 0; }

      #watch .digits li {
        font-weight: bold;
        font-family: sans-serif;
      }
    </script>
    <script id="show_digit_border_css" type="text/example-css">
      #watch .digits li { border: 1px solid red; }
    </script>
    <div class="row">
      <div class="col-md-6">
        <div id="single_digit_1_box" class="example-box-small" data-example="box" data-html="single_digit_1_html" data-css="single_digit_1_css" data-css-after="show_digit_border_css"></div>
      </div>
      <div class="col-md-6">
        <div id="single_digit_1_html_code" class="example-code" data-example="html" data-html="single_digit_1_html"></div>
        <div id="single_digit_1_css_code" class="example-code" data-example="css" data-css="single_digit_1_css"></div>
      </div>
    </div>
    <p>To properly align the digits, we have to <strong>center the digit</strong> inside its <code>&lt;li&gt;</code> tag. We make it <code>display: block;</code>, set <code>text-align: center;</code> to align horizontally and then set <code>width</code>, <code>height</code> and <code>line-height</code> the same as the digit size to align vertically. <span class="bg-warning">Extra borders added for testing purposes.</span></p>
    <script id="single_digit_2_css" type="text/example-css" data-import="single_digit_1_css">
      @digitSize: 1em;

      #watch .digits li {
        display: block;
        width: @digitSize; height: @digitSize;
        line-height: @digitSize;
        text-align: center;
      }
    </script>
    <div class="row">
      <div class="col-md-6">
        <div id="single_digit_2_box" class="example-box-small" data-example="box" data-html="single_digit_1_html" data-css="single_digit_2_css" data-css-after="show_digit_border_css"></div>
      </div>
      <div class="col-md-6">
        <div id="single_digit_2_css_code" class="example-code" data-example="css" data-css="single_digit_2_css"></div>
      </div>
    </div>
    <p><strong>Center the digit.</strong> Make the parent a positioned ancestor by setting <code>position: relative;</code>. Use <code>position: absolute;</code> and set <code>top</code> and <code>left</code> to <code>50%</code>. This will anchor the top-left corner of the digit to the center of the parent, but we want the center of the digit to be anchored, so we pull the digit half its width to the left and to the top with negative margin. <span class="bg-warning">Extra borders added for testing purposes.</span></p>
    <script id="single_digit_3_css" type="text/example-css" data-import="single_digit_2_css">
      @clockSize: 20em;

      #watch .digits {
        width: @clockSize; height: @clockSize;
        border-radius: (@clockSize / 2);
        position: relative;
      }

      #watch .digits li {
        position: absolute;
        top: 50%; left: 50%;
        margin: -(@digitSize / 2) 0 0 -(@digitSize / 2);
      }
    </script>
    <script id="show_digit_and_watch_border_css" type="text/example-css">
      #watch .digits { border: 1px solid blue; }
      #watch .digits li { border: 1px solid red; }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="single_digit_3_box" class="example-box" data-example="box" data-html="single_digit_1_html" data-css="single_digit_3_css" data-css-after="show_digit_and_watch_border_css" data-crosshairs="#888"></div>
      </div>
      <div class="col-md-6">
        <div id="single_digit_3_css_code" class="example-code" data-example="css" data-css="single_digit_3_css"></div>
      </div>
    </div>
    <p><strong>Move the digit to the border.</strong> Use <code>transform-translate</code> and move back half the size of the clock minus the size of the digit and the desired margin from the border. <span class="bg-warning">Extra borders added for testing purposes.</span></p>
    <script id="single_digit_4_css" type="text/example-css" data-import="single_digit_3_css">
      @digitMargin: 1em;

      #watch .digits li {
        &:nth-child(1) {
          @translate: (@clockSize / 2) -
                      (@digitSize / 2) -
                      @digitMargin;
          transform: translateY(-@translate);
        }
      }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="single_digit_4_box" class="example-box" data-example="box" data-html="single_digit_1_html" data-css="single_digit_4_css" data-css-after="show_digit_and_watch_border_css"></div>
      </div>
      <div class="col-md-6">
        <div id="single_digit_4_css_code" class="example-code" data-example="css" data-css="single_digit_4_css"></div>
      </div>
    </div>
    <p><strong>Move the digit to the right position.</strong> Use <code>transform-rotate</code> to rotate it around the center as defined by <code>transform-origin</code>. To calculate how many degrees we have to rotate to find the right position, we divide 360 degrees by 12 hours. <span class="bg-warning">Extra borders added for testing purposes.</span></p>
    <script id="single_digit_5_css" type="text/example-css" data-import="single_digit_3_css">
      @digitMargin: 1em;

      #watch .digits li {
        &:nth-child(1) {
          @translate: (@clockSize / 2) -
                      (@digitSize / 2) -
                      @digitMargin;
          @rotate: (360deg / 12) * 1;
          transform-origin: 50% @translate 0;
          transform: translateY(-@translate)
                     rotate(@rotate);
        }
      }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="single_digit_5_box" class="example-box" data-example="box" data-html="single_digit_1_html" data-css="single_digit_5_css" data-css-after="show_digit_and_watch_border_css"></div>
      </div>
      <div class="col-md-6">
        <div id="single_digit_5_css_code" class="example-code" data-example="css" data-css="single_digit_5_css"></div>
      </div>
    </div>
    <p><strong>Straighten the rotated digit.</strong> Now we would have to apply another rotation around itself in the reverse direction, but we can not set a different value for <code>transform-origin</code> for each transformation. We could use a wrapper element, we apply the first set of transformations to the outer element and the last rotation in the inner element. But instead, we will apply <a href="http://lea.verou.me/2012/02/moving-an-element-along-a-circle/">these transformations in a different order to avoid having to set the center or rotation</a>, thus being able to do it all in a sigle step. <span class="bg-warning">Extra borders added for testing purposes.</span></p>
    <script id="single_digit_6_css" type="text/example-css" data-import="single_digit_3_css">
      @digitMargin: 1em;

      #watch .digits li {
        &:nth-child(1) {
          @translate: (@clockSize / 2) -
                      (@digitSize / 2) -
                      @digitMargin;
          @rotate: (360deg / 12) * 1;
          transform: rotate(@rotate)
                     translateY(-@translate)
                     rotate(-@rotate);
        }
      }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="single_digit_6_box" class="example-box" data-example="box" data-html="single_digit_1_html" data-css="single_digit_6_css" data-css-after="show_digit_and_watch_border_css"></div>
      </div>
      <div class="col-md-6">
        <div id="single_digit_6_css_code" class="example-code" data-example="css" data-css="single_digit_6_css"></div>
      </div>
    </div>
    <p><strong>Add all digits.</strong> In the html part we are looping with <a href="https://lodash.com/docs#forEach">_.forEach</a> to generate 12 <code>&lt;li&gt;</code> tags with the digit as content. In the css part we are looping with <a href="http://lesscss.org/features/#loops-feature">recursive mixins</a> to generate the transformations for each digit with appropriate rotation calculed according to the index of the digit.</p>
    <script id="digits_html" type="text/example-html">
      <% var hours = _.range(12); %>

      <div id="watch">
        <ul class="digits">
          <% _.forEach(hours, function(hour) { %>
            <li><%- hour + 1 %></li>
          <% }); %>
        </ul>
      </div>
    </script>
    <script id="digits_css" type="text/example-css" data-import="single_digit_3_css">
      @digitMargin: 1em;
      @hours: 12;

      .transformDigits(@hour:1) when (@hour <= @hours) {
        @rotate: (360deg / @hours) * @hour;
        @translate: (@clockSize / 2) -
                    (@digitSize / 2) -
                    @digitMargin;
        &:nth-child(@{hour}) {
          transform: rotate(@rotate)
                     translateY(-@translate)
                     rotate(-@rotate);
        }
        .transformDigits((@hour + 1));
      }

      #watch .digits li {
        .transformDigits;
      }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="digits_box" class="example-box" data-example="box" data-html="digits_html" data-css="digits_css"></div>
      </div>
      <div class="col-md-6">
        <div id="digits_html_code" class="example-code" data-example="html" data-html="digits_html"></div>
        <div id="digits_css_code" class="example-code" data-example="css" data-css="digits_css"></div>
      </div>
    </div>
    <h2 id="marks" class="page-header">
      <a href="#marks" aria-hidden="true" class="anchor"><span class="glyphicon glyphicon-link"></span></a>
      Marks
    </h2>
    <script id="marks_transition_css" type="text/example-css">
      @clockSize: 20em;
      @markWidth: .2em;
      @markSize: .6em;
      @markColour: #929394;
      @markMargin: 1em;
      @minutes: 60;
      @hours: 12;

      #watch .marks {
        list-style: none; margin: 0; padding: 0;
        width: @clockSize; height: @clockSize;
        border-radius: (@clockSize / 2);
        position: relative;
      }

      #watch .marks li {
        display: block;
        width: @markWidth;
        height: @markSize;
        background: @markColour;
        position: absolute;
        .animationsForEachMark;
      }

      .animationsForEachMark(@minute:1) when (@minute <= @minutes) {
        @rotate: (360deg / @minutes) * @minute;
        @translate: (@clockSize / 2) -
                    (@markSize / 2) -
                    @markMargin;

        .findIfIsMinuteOrHour() {
          @markToRemoveOpacity: 1;
          @markToRemoveColour: @markColour;
          @markToRemoveTranslate: 0;
        }
        .findIfIsMinuteOrHour() when (mod(@minute, (@minutes / @hours)) = 0) {
          @markToRemoveOpacity: 0;
          @markToRemoveColour: red;
          @markToRemoveTranslate: @markMargin;
        }
        .findIfIsMinuteOrHour;

        @keyframes ~"addMark@{minute}" {
          0% {
            top: (@markSize * 1.42857143 * (@minute - 1));
            left: 0;
            margin: 0;
          }
          10% {
            top: 50%; left: 50%;
            margin: -(@markSize / 2) 0 0 -(@markSize / 2);
          }
          20% {
            top: 50%; left: 50%;
            margin: -(@markSize / 2) 0 0 -(@markSize / 2);
            transform: rotate(0);
          }
          30% {
            top: 50%; left: 50%;
            margin: -(@markSize / 2) 0 0 -(@markSize / 2);
            transform: rotate(@rotate);
          }
          40% {
            top: 50%; left: 50%;
            margin: -(@markSize / 2) 0 0 -(@markSize / 2);
            transform: rotate(@rotate) translateY(0);
          }
          50% {
            top: 50%; left: 50%;
            margin: -(@markSize / 2) 0 0 -(@markSize / 2);
            transform: rotate(@rotate)
                       translateY(-@translate);
          }
          60% {
            top: 50%; left: 50%;
            margin: -(@markSize / 2) 0 0 -(@markSize / 2);
            transform: rotate(@rotate)
                       translateY(-@translate);
            background: @markColour;
          }
          70% {
            top: 50%; left: 50%;
            margin: -(@markSize / 2) 0 0 -(@markSize / 2);
            transform: rotate(@rotate)
                       translateY(-@translate);
            background: @markToRemoveColour;
          }
          80% {
            top: 50%; left: 50%;
            margin: -(@markSize / 2) 0 0 -(@markSize / 2);
            transform: rotate(@rotate)
                       translateY(-@translate)
                       translateY(0);
            opacity: 1;
            background: @markToRemoveColour;
          }
          90% {
            top: 50%; left: 50%;
            margin: -(@markSize / 2) 0 0 -(@markSize / 2);
            transform: rotate(@rotate)
                       translateY(-@translate)
                       translateY(-@markToRemoveTranslate);
            opacity: @markToRemoveOpacity;
            background: @markToRemoveColour;
          }
          100% {
            top: 50%; left: 50%;
            margin: -(@markSize / 2) 0 0 -(@markSize / 2);
            transform: rotate(@rotate)
                       translateY(-@translate)
                       translateY(-@markToRemoveTranslate);
            opacity: @markToRemoveOpacity;
            background: @markToRemoveColour;
          }
        }

        &:nth-child(@{minute}) {
          animation: ~"addMark@{minute}" 8s ease infinite;
        }

        .animationsForEachMark((@minute + 1));
      }
    </script>
    <div class="text-center">
      <div id="marks_transition_box" class="example-box" data-example="box" data-html="marks_html" data-css="marks_transition_css"></div>
    </div>
    <p><strong>Add a mark.</strong> Same instructions as for the digits.</p>
    <script id="single_mark_1_html" type="text/example-html">
      <div id="watch">
        <ul class="marks">
          <li></li>
        </ul>
      </div>
    </script>
    <script id="single_mark_1_css" type="text/example-css">
      @markHeight: .6em;
      @markWidth: .2em;

      #watch .marks { list-style: none; margin: 0; padding: 0; }

      #watch .marks li {
        width: @markWidth; height: @markHeight;
        background: #929394;
      }
    </script>
    <div class="row">
      <div class="col-md-6">
        <div id="single_mark_1_box" class="example-box-small" data-example="box" data-html="single_mark_1_html" data-css="single_mark_1_css"></div>
      </div>
      <div class="col-md-6">
        <div id="single_mark_1_html_code" class="example-code" data-example="html" data-html="single_mark_1_html"></div>
        <div id="single_mark_1_css_code" class="example-code" data-example="css" data-css="single_mark_1_css"></div>
      </div>
    </div>
    <p><strong>Center the mark.</strong> Same instructions as for the digits. <span class="bg-warning">Extra borders added for testing purposes.</span></p>
    <script id="single_mark_2_css" type="text/example-css" data-import="single_mark_1_css">
      @clockSize: 20em;

      #watch .marks {
        width: @clockSize; height: @clockSize;
        border-radius: (@clockSize / 2);
        position: relative;
      }

      #watch .marks li {
        position: absolute;
        top: 50%; left: 50%;
        margin: -(@markHeight / 2) 0 0 -(@markWidth / 2);
      }
    </script>
    <script id="show_mark_and_watch_border_css" type="text/example-css">
      #watch .marks { border: 1px solid blue; }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="single_mark_2_box" class="example-box" data-example="box" data-html="single_mark_1_html" data-css="single_mark_2_css" data-css-after="show_mark_and_watch_border_css" data-crosshairs="#888"></div>
      </div>
      <div class="col-md-6">
        <div id="single_mark_2_css_code" class="example-code" data-example="css" data-css="single_mark_2_css"></div>
      </div>
    </div>
    <p><strong>Rotate the mark and move it to the border.</strong> Same instructions as for the digits, only this time there will be no third straightening out transformation. <span class="bg-warning">Extra borders added for testing purposes.</span></p>
    <script id="single_mark_3_css" type="text/example-css" data-import="single_mark_2_css">
      @markMargin: 1em;

      #watch .marks li {
        &:nth-child(1) {
          @translate: (@clockSize / 2) -
                      (@markHeight / 2) -
                      @markMargin;
          @rotate: (360deg / 60) * 1;
          transform: rotate(@rotate)
                     translateY(-@translate);
        }
      }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="single_mark_4_box" class="example-box" data-example="box" data-html="single_mark_1_html" data-css="single_mark_3_css" data-css-after="show_mark_and_watch_border_css"></div>
      </div>
      <div class="col-md-6">
        <div id="single_mark_3_css_code" class="example-code" data-example="css" data-css="single_mark_3_css"></div>
      </div>
    </div>
    <p><strong>Add all marks.</strong> In the html part we are looping with <a href="https://lodash.com/docs#forEach">_.forEach</a> to generate 60 empty <code>&lt;li&gt;</code> tags. In the css part we are looping with <a href="http://lesscss.org/features/#loops-feature">recursive mixins</a> to generate the transformations for each mark with appropriate rotation calculed according to the index of the mark.</p>
    <script id="marks_html" type="text/example-html">
      <% var minutes = _.range(60); %>

      <div id="watch">
        <ul class="marks">
          <% _.forEach(minutes, function() { %>
            <li></li>
          <% }); %>
        </ul>
      </div>
    </script>
    <script id="marks_css" type="text/example-css" data-import="single_mark_2_css">
      @markMargin: 1em;
      @minutes: 60;

      .transformMarks(@minute:1) when (@minute <= @minutes) {
        @rotate: (360deg / @minutes) * @minute;
        @translate: (@clockSize / 2) -
                    (@markHeight / 2) -
                    @markMargin;
        &:nth-child(@{minute}) {
          transform: rotate(@rotate)
                     translateY(-@translate);
        }
        .transformMarks((@minute + 1));
      }

      #watch .marks li {
        .transformMarks;
      }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="marks_box" class="example-box" data-example="box" data-html="marks_html" data-css="marks_css"></div>
      </div>
      <div class="col-md-6">
        <div id="marks_html_code" class="example-code" data-example="html" data-html="marks_html"></div>
        <div id="marks_css_code" class="example-code" data-example="css" data-css="marks_css"></div>
      </div>
    </div>
    <p><strong>Hide the marks</strong> where the hours should be. Change the less loop to conditionally hide every 5 marks (60 minutes / 12 hours).</p>
    <script id="marks_2_css" type="text/example-css" data-import="single_mark_2_css">
      @markMargin: 1em;
      @minutes: 60;
      @hours: 12;

      .transformMarks(@minute:1) when (@minute <= @minutes) {
        @rotate: (360deg / @minutes) * @minute;
        @translate: (@clockSize / 2) -
                    (@markHeight / 2) -
                    @markMargin;

        .findIfIsMinuteOrHour() {
          @visibility: visible;
        }
        .findIfIsMinuteOrHour() when (mod(@minute, (@minutes / @hours)) = 0) {
          @visibility: hidden;
        }
        .findIfIsMinuteOrHour;

        &:nth-child(@{minute}) {
          transform: rotate(@rotate)
                     translateY(-@translate);
          visibility: @visibility;
        }
        .transformMarks((@minute + 1));
      }

      #watch .marks li {
        .transformMarks;
      }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="marks_2_box" class="example-box" data-example="box" data-html="marks_html" data-css="marks_2_css"></div>
      </div>
      <div class="col-md-6">
        <div id="marks_css_code" class="example-code" data-example="css" data-css="marks_2_css"></div>
      </div>
    </div>
    <h2 id="hands" class="page-header">
      <a href="#hands" aria-hidden="true" class="anchor"><span class="glyphicon glyphicon-link"></span></a>
      Hands
    </h2>
    <script id="hand_transition_css" type="text/example-css">
      @clockSize: 20em;
      @handHeight: 10em;
      @handTail: 2em;
      @handWidth: .2em;

      #watch {
        position: relative;
        width: @clockSize; height: @clockSize;
        border-radius: (@clockSize / 2);
      }

      #watch .hand {
        height: @handHeight;
        width: @handWidth;
        background: #c00;
        position: absolute;
        animation: addHand 6s ease infinite;
      }

      @centerOfRotationX: (@handWidth / 2);
      @centerOfRotationY: (@handHeight - @handTail);
      @rotate: (360deg / 60) * 1;

      @keyframes addHand {
        0% {
          top: 0;
          left: 0;
          margin: 0;
        }
        16.67% {
          top: 50%; left: 50%;
          margin: -@handHeight 0 0 -(@handWidth / 2);
        }
        33.33% {
          top: 50%; left: 50%;
          margin: -@handHeight 0 0 -(@handWidth / 2);
        }
        50% {
          top: 50%; left: 50%;
          margin: -(@handHeight - @handTail) 0 0 -(@handWidth / 2);
        }
        66.67% {
          top: 50%; left: 50%;
          margin: -(@handHeight - @handTail) 0 0 -(@handWidth / 2);
          transform-origin: @centerOfRotationX @centerOfRotationY 0;
          transform: rotate(0);
        }
        83.33% {
          top: 50%; left: 50%;
          margin: -(@handHeight - @handTail) 0 0 -(@handWidth / 2);
          transform-origin: @centerOfRotationX @centerOfRotationY 0;
          transform: rotate(@rotate);
        }
        100% {
          top: 50%; left: 50%;
          margin: -(@handHeight - @handTail) 0 0 -(@handWidth / 2);
          transform-origin: @centerOfRotationX @centerOfRotationY 0;
          transform: rotate(@rotate);
        }
      }
    </script>
    <div class="text-center">
      <div id="hand_transition_box" class="example-box" data-example="box" data-html="single_hand_1_html" data-css="hand_transition_css"></div>
    </div>
    <p><strong>Add a hand.</strong> Just create a <code>&lt;div&gt;</code> with the desired <code>background</code>, <code>height</code> (length) and <code>width</code>.</p>
    <script id="single_hand_1_html" type="text/example-html">
      <div id="watch">
        <div class="hand"></div>
      </div>
    </script>
    <script id="single_hand_1_css" type="text/example-css">
      @handHeight: 8em;
      @handWidth: .2em;

      #watch .hand {
        height: @handHeight;
        width: @handWidth;
        background: #c00;
      }
    </script>
    <div class="row">
      <div class="col-md-6">
        <div id="single_hand_1_box" class="example-box-small" data-example="box" data-html="single_hand_1_html" data-css="single_hand_1_css"></div>
      </div>
      <div class="col-md-6">
        <div id="single_hand_1_html_code" class="example-code" data-example="html" data-html="single_hand_1_html"></div>
        <div id="single_hand_1_css_code" class="example-code" data-example="css" data-css="single_hand_1_css"></div>
      </div>
    </div>
    <p><strong>Move the hand to the center.</strong> Similar instructions as for digits and marks, but the positioned ancestor now is the <code>#watch</code> container. Now we will still center it horizontally, but instead of centering it vertically, we will anchor the bottom of the hand to the center of the watch by pulling its whole height to the top with negative margin instead of just half. <span class="bg-warning">Extra borders added for testing purposes.</span></p>
    <script id="single_hand_2_css" type="text/example-css" data-import="single_hand_1_css">
      @clockSize: 20em;

      #watch { position: relative; }

      #watch .hand {
        position: absolute;
        top: 50%; left: 50%;
        margin: -@handHeight 0 0 -(@handWidth / 2);
      }

      /* This is not part of the final code
       * These lines are needed only without the frame */
      #watch {
        width: @clockSize; height: @clockSize;
        border-radius: (@clockSize / 2);
      }
    </script>
    <script id="show_hand_and_watch_border_css" type="text/example-css">
      #watch { border: 1px solid blue; }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="single_hand_2_box" class="example-box" data-example="box" data-html="single_hand_1_html" data-css="single_hand_2_css" data-css-after="show_hand_and_watch_border_css" data-crosshairs="#888"></div>
      </div>
      <div class="col-md-6">
        <div id="single_hand_2_css_code" class="example-code" data-example="css" data-css="single_hand_2_css"></div>
      </div>
    </div>
    <p><strong>Add a tail to the hand.</strong> Change the <code>margin-top</code> so we do not pull its whole length to the top with negative margin. <span class="bg-warning">Extra borders added for testing purposes.</span></p>
    <script id="single_hand_3_css" type="text/example-css" data-import="single_hand_2_css">
      @handHeight: 10em;
      @handTail: 2em;

      #watch .hand {
        margin: -(@handHeight - @handTail) 0 0 -(@handWidth / 2);
      }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="single_hand_3_box" class="example-box" data-example="box" data-html="single_hand_1_html" data-css="single_hand_3_css" data-css-after="show_hand_and_watch_border_css" data-crosshairs="#888"></div>
      </div>
      <div class="col-md-6">
        <div id="single_hand_3_css_code" class="example-code" data-example="css" data-css="single_hand_3_css"></div>
      </div>
    </div>
    <p><strong>Rotate the hand around the center of the watch.</strong> We negate the offsets that we calculated for the negative margins to find the center of the watch and therefore our center of rotation. We set it in <code>transform-origin</code>. <span class="bg-warning">Extra borders added for testing purposes.</span></p>
    <script id="single_hand_4_css" type="text/example-css" data-import="single_hand_3_css">
      #watch .hand {
        @centerOfRotationX: (@handWidth / 2);
        @centerOfRotationY: (@handHeight - @handTail);
        @rotate: (360deg / 60) * 1;

        transform-origin: @centerOfRotationX @centerOfRotationY 0;
        transform: rotate(@rotate);
      }
    </script>
    <div class="row">
      <div class="col-md-6 text-center">
        <div id="single_hand_4_box" class="example-box" data-example="box" data-html="single_hand_1_html" data-css="single_hand_4_css" data-css-after="show_hand_and_watch_border_css" data-crosshairs="#888"></div>
      </div>
      <div class="col-md-6">
        <div id="single_hand_4_css_code" class="example-code" data-example="css" data-css="single_hand_4_css"></div>
      </div>
    </div>
    <h2 id="putting-them-together" class="page-header">
      <a href="#putting-them-together" aria-hidden="true" class="anchor"><span class="glyphicon glyphicon-link"></span></a>
      Putting them together
    </h2>
    <h2 id="animation" class="page-header">
      <a href="#animation" aria-hidden="true" class="anchor"><span class="glyphicon glyphicon-link"></span></a>
      Animation
    </h2>
    <h2 id="current-time" class="page-header">
      <a href="#current-time" aria-hidden="true" class="anchor"><span class="glyphicon glyphicon-link"></span></a>
      Current time
    </h2>
    <h2 id="builder" class="page-header">
      <a href="#builder" aria-hidden="true" class="anchor"><span class="glyphicon glyphicon-link"></span></a>
      Builder
    </h2>
    <h2 id="decimal-time" class="page-header">
      <a href="#decimal-time" aria-hidden="true" class="anchor"><span class="glyphicon glyphicon-link"></span></a>
      Decimal time
    </h2>
  </div>

  <script src="/clock/js/lodash.min.js"></script>
  <script src="/clock/js/less.min.js"></script>
  <script src="/clock/js/jquery.min.js"></script>
  <script src="/clock/js/bootstrap.min.js"></script>
  <script src="/clock/js/ie10-viewport-bug-workaround.js"></script>
  <script src="/clock/js/highlight.min.js"></script>
  <script type="text/javascript">
    function unindent(script) {
      var lines = script.split('\n');
      // Remove trailing spaces
      var lines2 = _.map(lines, _.trimRight);
      // Remove blank lines from the beginning
      var lines3 = _.dropWhile(lines2, function(line) {
        return line.length === 0;
      });
      // Remove blank lines from the end
      var lines4 = _.dropRightWhile(lines3, function(line) {
        return line.length === 0;
      });
      if (lines4.length === 0) {
        return lines4;
      }
      var identation = lines4[0].length - _.trimLeft(lines4[0]).length;
      var lines5 = _.map(lines4, function(line) {
        return line.slice(identation);
      });
      return lines5.join('\n');
    }

    function readLess(cssId) {
      var $css = $('#' + cssId);
      var prepend = '';
      var prependId = $css.data('import');
      if (prependId != null) {
        prepend = readLess(prependId);;
      }
      return prepend + $css.html();
    }

    function readExampleCode(htmlId, cssId, postCssId) {
      return new Promise(function(done) {
        var code = {};
        var lodash = $('#' + htmlId).html();
        code.html = _.template(lodash)();
        var lessScript = readLess(cssId);
        var postLessScript = postCssId != null ? readLess(postCssId) : '';
        less.render(lessScript + postLessScript).then(function(output) {
          code.css = output.css;
          done(code);
        }).catch(function(err) {
          throw err;
        });
      });
    }

    function generateCodeBlock($parent, code, type) {
      var highlighted = hljs.highlight(type, unindent(code)).value;
      return '<pre class="hljs ' + type + '">' + highlighted + '</pre>';
    }

    jQuery(function($) {
      $('[data-example="box"]').each(function() {
        var $el = $(this), prefix = $el.attr('id');
        readExampleCode($el.data('html'), $el.data('css'), $el.data('css-after')).then(function(code) {
          var html = code.html;
          // Make ids unique
          html = html.replace(/id=['"](.*?)['"]/g, 'id="' + prefix + '_$1"');
          // Make classes unique
          html = html.replace(/class=['"](.*?)['"]/g, function(match, cssClass) {
            return 'class="' + cssClass.replace(/([^ ]+)/g, prefix + '_$1') + '"';
          });
          var css  = code.css;
          // Make ids unique
          css = css.replace(/#([a-z0-9_\-]*)/g, function(match, id) {
            // If it is a colour, do not touch it
            if (id.match(/^[a-fA-F0-9]{3,6}$/)) {
              return match;
            }
            return '#' + prefix + '_' + id;
          });
          // Makes classes unique
          css = css.replace(/\.([a-z][a-zA-Z0-9_\-]*)/g, '.' + prefix + '_$1');
          $el.append('<style type="text/css">' + css + '</style>' + html);
        });
      });

      $('[data-example="html"]').each(function() {
        var $el    = $(this);
        var htmlId = $el.data('html');
        var code   = $('#' + htmlId).html();
        $el.append(generateCodeBlock($el, code, 'html'));
      });

      $('[data-example="css"]').each(function() {
        var $el   = $(this);
        var cssId = $el.data('css');
        var code  = $('#' + cssId).html();
        $el.append(generateCodeBlock($el, code, 'less'));
      });

      $('[data-crosshairs]').each(function() {
        var colour = $(this).data('crosshairs');
        var style = 'style="background-color: ' + colour + ';"';
        var vertical   = '<div class="crosshairs-vertical" ' + style + '></div>';
        var horizontal = '<div class="crosshairs-horizontal" ' + style + '></div>';
        $(this).append('<div class ="crosshairs-layer">' + vertical + horizontal + '</div>');
      });
    });
  </script>
</body></html>
